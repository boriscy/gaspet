<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ParteDiario</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ParteDiario</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/parte_diario_rb.html">
                app/models/parte_diario.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000046">buscar_por_fecha</a>&nbsp;&nbsp;
      <a href="#M000048">cols</a>&nbsp;&nbsp;
      <a href="#M000049">crear</a>&nbsp;&nbsp;
      <a href="#M000051">guardar</a>&nbsp;&nbsp;
      <a href="#M000047">importar</a>&nbsp;&nbsp;
      <a href="#M000053">produccion_mensual_gas</a>&nbsp;&nbsp;
      <a href="#M000054">produccion_mensual_liquidos</a>&nbsp;&nbsp;
      <a href="#M000055">produccion_resumen</a>&nbsp;&nbsp;
      <a href="#M000050">reporte</a>&nbsp;&nbsp;
      <a href="#M000052">reporte_diario</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000046" class="method-detail">
        <a name="M000046"></a>

        <div class="method-heading">
          <a href="#M000046" class="method-signature">
          <span class="method-name">buscar_por_fecha</span><span class="method-args">(fecha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Realiza la busqueda por fecha @param date fecha @return array
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000046-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000046-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 10</span>
10:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">buscar_por_fecha</span>(<span class="ruby-identifier">fecha</span>)
11:     <span class="ruby-identifier">ret</span> = []
12:     <span class="ruby-identifier">lista</span> = []
13:     <span class="ruby-constant">ParteDiario</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">lista</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;fecha&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;updated_at&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;created_at&quot;</span>}
14:     <span class="ruby-identifier">tmp</span> = {}
15: 
16:     <span class="ruby-identifier">pd</span> = <span class="ruby-constant">ParteDiario</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;fecha = ?&quot;</span>, <span class="ruby-identifier">fecha</span>], <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:campo</span>], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'campos.nombre ASC'</span>)
17: 
18:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
19:       <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
20:         <span class="ruby-identifier">tmp</span> = {<span class="ruby-identifier">:campo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">campo</span>.<span class="ruby-identifier">nombre</span>}
21:         <span class="ruby-identifier">lista</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tmp</span>[<span class="ruby-identifier">col</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">col</span>)}
22:         <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">tmp</span>)
23:       <span class="ruby-keyword kw">end</span>
24:     <span class="ruby-keyword kw">else</span>
25:       <span class="ruby-identifier">campos</span> = <span class="ruby-constant">Campo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
26:       <span class="ruby-identifier">campos</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
27:         <span class="ruby-identifier">tmp</span> = {<span class="ruby-identifier">:campo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nombre</span>, <span class="ruby-identifier">:campo_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">id</span>}
28:         <span class="ruby-identifier">lista</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
29:           <span class="ruby-identifier">tmp</span>[<span class="ruby-identifier">col</span>] = <span class="ruby-value">0</span><span class="ruby-value">.0</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">col</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:campo_id</span>
30:         <span class="ruby-keyword kw">end</span>
31:         <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">tmp</span>)
32:       <span class="ruby-keyword kw">end</span>
33:     <span class="ruby-keyword kw">end</span>
34:       
35:     <span class="ruby-identifier">ret</span>
36:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000048" class="method-detail">
        <a name="M000048"></a>

        <div class="method-heading">
          <a href="#M000048" class="method-signature">
          <span class="method-name">cols</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000048-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000048-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 91</span>
91:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cols</span>
92:     <span class="ruby-identifier">cols</span> = [] <span class="ruby-comment cmt"># Columnas de la tabla</span>
93:     <span class="ruby-constant">ParteDiario</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span>)  <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'created_at'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'updated_at'</span>}
94:     <span class="ruby-identifier">cols</span>
95:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000049" class="method-detail">
        <a name="M000049"></a>

        <div class="method-heading">
          <a href="#M000049" class="method-signature">
          <span class="method-name">crear</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000049-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000049-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 97</span>
 97:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">crear</span>(<span class="ruby-identifier">params</span>)
 98:     <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">cols</span>()
 99:     <span class="ruby-identifier">res</span> = {<span class="ruby-identifier">:success</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> []}
100:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tran</span><span class="ruby-operator">|</span>
101:       <span class="ruby-comment cmt"># Almacenamiento de las transacciones</span>
102:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">parte</span><span class="ruby-operator">|</span>
103:         <span class="ruby-identifier">parte_diario</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">parte</span>)
104:         <span class="ruby-keyword kw">begin</span>
105:           <span class="ruby-identifier">parte_diario</span>.<span class="ruby-identifier">save!</span>
106:         <span class="ruby-keyword kw">rescue</span>
107:           <span class="ruby-identifier">res</span>[<span class="ruby-identifier">:success</span>] = <span class="ruby-keyword kw">nil</span>
108:         <span class="ruby-keyword kw">end</span>
109:         <span class="ruby-identifier">res</span>[<span class="ruby-identifier">:data</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">parte_diario</span>)
110:       <span class="ruby-keyword kw">end</span>
111:       <span class="ruby-comment cmt"># En caso de error</span>
112:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>, <span class="ruby-value str">&quot;Error de transacción ParteDiario!&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">res</span>[<span class="ruby-identifier">:success</span>]
113:     <span class="ruby-keyword kw">end</span>
114:     <span class="ruby-identifier">res</span>
115:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000051" class="method-detail">
        <a name="M000051"></a>

        <div class="method-heading">
          <a href="#M000051" class="method-signature">
          <span class="method-name">guardar</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Guarda los datos mediante una transación
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000051-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000051-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 147</span>
147:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">guardar</span>(<span class="ruby-identifier">params</span>)
148:     <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">cols</span>()
149:     <span class="ruby-identifier">res</span> = {<span class="ruby-identifier">:errors</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-identifier">:success</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}
150:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">parte</span><span class="ruby-operator">|</span>
151: 
152:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
153:         <span class="ruby-identifier">temp</span> = {<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>[<span class="ruby-value str">'id'</span>].<span class="ruby-identifier">to_i</span>}
154:         <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">temp</span>[<span class="ruby-identifier">v</span>] = <span class="ruby-identifier">val</span>[<span class="ruby-identifier">v</span>] }
155:         <span class="ruby-identifier">temp</span>[<span class="ruby-identifier">:fecha</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:fecha</span>]
156: 
157:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">temp</span>[<span class="ruby-identifier">:id</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
158:           <span class="ruby-identifier">pd</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">temp</span>)
159:         <span class="ruby-keyword kw">else</span>
160:           <span class="ruby-identifier">pd</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">temp</span>)
161:         <span class="ruby-keyword kw">end</span>
162: 
163:         <span class="ruby-keyword kw">begin</span>
164:           <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">save!</span>
165:         <span class="ruby-keyword kw">rescue</span>
166:           <span class="ruby-identifier">errors</span> = {}
167:           <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">error</span><span class="ruby-operator">|</span>
168:             <span class="ruby-identifier">errors</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">error</span>
169:           }
170:           <span class="ruby-identifier">res</span>[<span class="ruby-identifier">:errors</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">errors</span>)
171:           <span class="ruby-identifier">res</span>[<span class="ruby-identifier">:success</span>] = <span class="ruby-keyword kw">false</span>
172:         <span class="ruby-keyword kw">end</span>
173:       <span class="ruby-keyword kw">end</span>
174:       
175:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>, <span class="ruby-value str">&quot;Error de transacción ParteDiario!&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">res</span>[<span class="ruby-identifier">:success</span>]
176:     <span class="ruby-keyword kw">end</span>
177:     <span class="ruby-identifier">res</span>
178:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000047" class="method-detail">
        <a name="M000047"></a>

        <div class="method-heading">
          <a href="#M000047" class="method-signature">
          <span class="method-name">importar</span><span class="method-args">(file, fecha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Importa los datos de un archivo de Excel, Excel 2007 o OpneOffice nombre
del archivo a <a href="ParteDiario.html#M000047">importar</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000047-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000047-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 41</span>
41:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">importar</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">fecha</span>)
42:     <span class="ruby-identifier">archivo</span> = <span class="ruby-constant">Asignacion</span>.<span class="ruby-identifier">import_sheet</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value">0</span>)
43:     <span class="ruby-identifier">ret</span> = {<span class="ruby-identifier">:imported</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-identifier">:original</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-identifier">:errors</span> =<span class="ruby-operator">&gt;</span> []}
44:     <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">cols</span>()
45:     <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;fecha&quot;</span>)
46:     <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;campo_id&quot;</span>)
47:     <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;id&quot;</span>)
48: 
49:     <span class="ruby-comment cmt"># fecha = archivo.cell(4, 'A').gsub(/\//, '-')</span>
50:     <span class="ruby-identifier">campos</span> = <span class="ruby-constant">Campo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
51:     <span class="ruby-identifier">fecha2</span> = <span class="ruby-identifier">fecha</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\A^(\d\d)-(\d\d)-(\d{4})$\Z/</span>, <span class="ruby-value str">'\3-\2-\1'</span>)
52:     <span class="ruby-identifier">partes</span> = <span class="ruby-identifier">find</span> <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;fecha=?&quot;</span>, <span class="ruby-identifier">fecha2</span>]
53: 
54:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">partes</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
55:       <span class="ruby-value">9</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">90</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fila</span><span class="ruby-operator">|</span>
56:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>,<span class="ruby-value str">'B'</span>).<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>,<span class="ruby-value str">'C'</span>).<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Float'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>,<span class="ruby-value str">'B'</span>) <span class="ruby-operator">!=</span> <span class="ruby-value str">'PLANTA'</span>
57:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>,<span class="ruby-value str">'B'</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>
58:             <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
59:             <span class="ruby-identifier">campo</span> = <span class="ruby-identifier">campos</span>.<span class="ruby-identifier">detect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nombre</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-value str">'B'</span>).<span class="ruby-identifier">squish</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">sinonimo</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-value str">'B'</span>).<span class="ruby-identifier">squish</span>}
60:             <span class="ruby-identifier">tmp</span> = {<span class="ruby-identifier">:campo_id</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">campo</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">campo</span>.<span class="ruby-identifier">nil?</span>), <span class="ruby-identifier">:fecha</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fecha</span>}
61:             <span class="ruby-comment cmt"># Hoja original</span>
62:             <span class="ruby-identifier">tmpOrig</span> = [<span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-value str">&quot;A&quot;</span>), <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-value str">&quot;B&quot;</span>)]
63:             (<span class="ruby-value str">&quot;C&quot;</span><span class="ruby-operator">..</span><span class="ruby-value str">&quot;U&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rango</span><span class="ruby-operator">|</span>
64:               <span class="ruby-identifier">tmp</span>[<span class="ruby-identifier">cols</span>[<span class="ruby-identifier">i</span>]] = <span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-identifier">rango</span>).<span class="ruby-identifier">to_f</span>.<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
65:               <span class="ruby-identifier">tmpOrig</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-identifier">rango</span>))
66:               <span class="ruby-identifier">i</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>
67:             <span class="ruby-keyword kw">end</span>
68:             <span class="ruby-identifier">parte</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tmp</span>)
69:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parte</span>.<span class="ruby-identifier">campo_id</span>.<span class="ruby-identifier">nil?</span>
70:               <span class="ruby-identifier">parte</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">:campo_id</span>, <span class="ruby-node">&quot;El campo #{archivo.cell(fila, 'B')} no existe&quot;</span>)
71:               <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:errors</span>].<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;El campo #{archivo.cell(fila, 'B')} no existe&quot;</span>)
72:             <span class="ruby-keyword kw">end</span>
73:             <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:imported</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">parte</span>)
74:             <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:original</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">tmpOrig</span>)
75:           <span class="ruby-keyword kw">end</span>
76:         <span class="ruby-keyword kw">else</span>
77:           <span class="ruby-identifier">tmpOrig</span> = [<span class="ruby-keyword kw">false</span>]
78:           (<span class="ruby-value str">&quot;A&quot;</span><span class="ruby-operator">..</span><span class="ruby-value str">&quot;U&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rango</span><span class="ruby-operator">|</span>
79:             <span class="ruby-identifier">tmpOrig</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">archivo</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">fila</span>, <span class="ruby-identifier">rango</span>))
80:           <span class="ruby-keyword kw">end</span>
81:           <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:original</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">tmpOrig</span>)
82:         <span class="ruby-keyword kw">end</span>
83:       <span class="ruby-keyword kw">end</span>
84:     <span class="ruby-keyword kw">else</span>
85:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:errors</span>].<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;El parte diario de fecha #{fecha} ya existe en la Base de Datos&quot;</span>)
86:     <span class="ruby-keyword kw">end</span>
87: 
88:     <span class="ruby-identifier">ret</span>
89:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000053" class="method-detail">
        <a name="M000053"></a>

        <div class="method-heading">
          <a href="#M000053" class="method-signature">
          <span class="method-name">produccion_mensual_gas</span><span class="method-args">(fecha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Realiza la consulta para extraer la produccion total, entrega totales por
mes de gas @param fecha date la fecha del mes deseado
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000053-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000053-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 195</span>
195:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">produccion_mensual_gas</span>(<span class="ruby-identifier">fecha</span>)
196:     <span class="ruby-identifier">sql</span> = [<span class="ruby-value str">&quot;SELECT partes_diarios.fecha,
197:        SUM(partes_diarios.produccion_gas) AS produccion,
198:        SUM(partes_diarios.entregado_gasoducto) AS entregado
199:        FROM partes_diarios
200:        WHERE partes_diarios.fecha BETWEEN ? AND ?
201:        GROUP BY partes_diarios.fecha&quot;</span>, <span class="ruby-identifier">fecha</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">to_date</span>, <span class="ruby-identifier">fecha</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">to_date</span>]
202:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-identifier">sql</span>)
203:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="#M000054" class="method-signature">
          <span class="method-name">produccion_mensual_liquidos</span><span class="method-args">(fecha)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Realiza la consulta para extraer la produccion total, entrega totales por
mes de liquidos @param fecha date la fecha del mes deseado
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000054-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000054-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 209</span>
209:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">produccion_mensual_liquidos</span>(<span class="ruby-identifier">fecha</span>)
210:     <span class="ruby-identifier">sql</span> = [<span class="ruby-value str">&quot;SELECT partes_diarios.fecha,
211:        SUM(partes_diarios.produccion_liquidos) AS produccion,
212:        SUM(partes_diarios.petroleo_entregado) AS entregado
213:        FROM partes_diarios
214:        WHERE partes_diarios.fecha BETWEEN ? AND ?
215:        GROUP BY partes_diarios.fecha&quot;</span>, <span class="ruby-identifier">fecha</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">to_date</span>, <span class="ruby-identifier">fecha</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">to_date</span>]
216:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-identifier">sql</span>)
217:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <a href="#M000055" class="method-signature">
          <span class="method-name">produccion_resumen</span><span class="method-args">(fecha_ini = nil, fecha_fin = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Realiza una consulta que resume la información
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000055-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000055-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 220</span>
220:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">produccion_resumen</span>(<span class="ruby-identifier">fecha_ini</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">fecha_fin</span> = <span class="ruby-keyword kw">nil</span>)
221:     <span class="ruby-identifier">ret</span> = {}
222:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fecha_ini</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">fecha_fin</span>.<span class="ruby-identifier">nil?</span>
223:       <span class="ruby-identifier">fecha_fin</span> = <span class="ruby-constant">ParteDiario</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:fecha</span>)
224:       <span class="ruby-identifier">fecha_ini</span> = <span class="ruby-identifier">fecha_fin</span> <span class="ruby-operator">-</span> <span class="ruby-value">30</span>.<span class="ruby-identifier">days</span>
225:     <span class="ruby-keyword kw">end</span>
226:     
227:     <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;SELECT campo_id, SUM(petroleo) AS petroleo, SUM(condensado) AS condensado, SUM(gasolina) AS gasolina,
228:     SUM(entregado_gasoducto) as gas
229:     FROM partes_diarios WHERE fecha BETWEEN ? AND ? GROUP BY campo_id&quot;</span>
230:     <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:produccion_campo</span>] = <span class="ruby-constant">ParteDiario</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">fecha_ini</span>, <span class="ruby-identifier">fecha_fin</span>])
231:     [<span class="ruby-identifier">:petroleo</span>, <span class="ruby-identifier">:condensado</span>, <span class="ruby-identifier">:gasolina</span>, <span class="ruby-identifier">:gas</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">v</span>] = <span class="ruby-value">0</span>}
232:     <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:produccion_campo</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">campo</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">v</span>]<span class="ruby-operator">+=</span> <span class="ruby-identifier">campo</span>[<span class="ruby-identifier">v</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;String&quot;</span> } }
233:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000050" class="method-detail">
        <a name="M000050"></a>

        <div class="method-heading">
          <a href="#M000050" class="method-signature">
          <span class="method-name">reporte</span><span class="method-args">(fecha_ini, fecha_fin, op)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Genera el <a href="ParteDiario.html#M000050">reporte</a> a partir de la
fecha incial, fecha final, operación
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000050-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000050-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 119</span>
119:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reporte</span>(<span class="ruby-identifier">fecha_ini</span>, <span class="ruby-identifier">fecha_fin</span>, <span class="ruby-identifier">op</span>)
120:     <span class="ruby-keyword kw">case</span>(<span class="ruby-identifier">op</span>)
121:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;SUM&quot;</span>
122:       <span class="ruby-identifier">op</span> = <span class="ruby-value str">&quot;SUM&quot;</span>
123:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;AVG&quot;</span>
124:       <span class="ruby-identifier">op</span> = <span class="ruby-value str">&quot;AVG&quot;</span>
125:     <span class="ruby-keyword kw">else</span>
126:       <span class="ruby-identifier">op</span> = <span class="ruby-value str">&quot;SUM&quot;</span>
127:     <span class="ruby-keyword kw">end</span>
128:     <span class="ruby-identifier">columns</span> = []
129:     <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">v</span>) <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'id'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'campo_id'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'fecha'</span>)}
130:     <span class="ruby-identifier">j</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{v=='densidad_api' ? 'AVG': op}(pd.#{v}) AS #{v}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
131:     <span class="ruby-identifier">query</span> = <span class="ruby-node">&quot;SELECT v.empresa AS empresa, v.campo AS campo, #{j}  FROM
132:     partes_diarios pd JOIN view_campos_detalles v ON (pd.campo_id = v.campo_id)
133:     WHERE pd.fecha &gt;= '#{fecha_ini}' AND pd.fecha &lt;= '#{fecha_fin}'
134:     GROUP BY pd.campo_id ORDER BY v.campo&quot;</span>
135:     <span class="ruby-comment cmt">#report_table_by_sql(query, :only =&gt; [:empresa, :campo])</span>
136:     <span class="ruby-identifier">columns</span> = [<span class="ruby-value str">&quot;empresa&quot;</span>,<span class="ruby-value str">&quot;campo&quot;</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">columns</span>)
137:     <span class="ruby-identifier">t</span> = <span class="ruby-identifier">report_table_by_sql</span>(<span class="ruby-identifier">query</span>)
138:     <span class="ruby-comment cmt"># En caso de que no haya devuelto 0 registros</span>
139:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
140:       <span class="ruby-identifier">t</span>.<span class="ruby-identifier">reorder</span>(<span class="ruby-identifier">columns</span>)
141:       <span class="ruby-identifier">t</span>.<span class="ruby-identifier">rename_columns</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:humanize</span>))
142:     <span class="ruby-keyword kw">end</span>
143:     <span class="ruby-identifier">t</span>
144:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000052" class="method-detail">
        <a name="M000052"></a>

        <div class="method-heading">
          <a href="#M000052" class="method-signature">
          <span class="method-name">reporte_diario</span><span class="method-args">(fecha = Time.now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Define la consulta SQL y la logica para la presentacion de de los reportes
diarios, por defecto la fecha es la actual.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000052-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000052-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/parte_diario.rb, line 183</span>
183:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reporte_diario</span>(<span class="ruby-identifier">fecha</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
184:     <span class="ruby-identifier">sql</span> = [<span class="ruby-value str">&quot;SELECT fecha, produccion_liquidos AS produccion
185:           FROM partes_diarios
186:           WHERE fecha = ?&quot;</span>, <span class="ruby-identifier">fecha</span>.<span class="ruby-identifier">to_date</span>]
187: 
188:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-identifier">sql</span>)
189:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>